package org.ebu.medialab.player;

import org.xbill.DNS.CNAMERecord;
import org.xbill.DNS.Lookup;
import org.xbill.DNS.Record;
import org.xbill.DNS.SRVRecord;
import org.xbill.DNS.TextParseException;
import org.xbill.DNS.Type;

import android.util.Log;

public class RadioDNS {
	
	String host;
	int port;
	
	public RadioDNS(String request) {
	        Record[] records;
	        Lookup l1 = null;
	        Lookup l2 = null;
			try {
				String initialreq=request+".radiodns.org";
				l1 = new Lookup(initialreq, Type.CNAME);
				Record[] r1 = l1.run();
				Log.d("EBUPLAYER", "DNS CNAME LOOKUP:"+initialreq+" (status:"+l1.getResult()+")");
				
				String cname = "";
				if(r1.length>0){
					CNAMERecord r  = (CNAMERecord) r1[0];
					cname = r.getAlias().toString();
					cname = cname.substring(0, cname.length()-1);
					Log.d("EBUPLAYER", "RESULT CNAME:"+r.getAlias());
				}
				
				String servicereq = "_radiovis._tcp."+cname;
				l2 = new Lookup(servicereq, Type.SRV);
				records = l2.run();
				Log.d("EBUPLAYER", "DNS SRV LOOKUP:"+servicereq+" (status:"+l2.getResult()+")");
				
				
				
				
		        if(records.length>0){
		        	SRVRecord srv = (SRVRecord) records[0];
		        	String server = srv.getTarget().toString();
		        	server.substring(0, server.length()-1);		        	
		        	
		        	Log.d("EBUPLAYER", "RESULT SRV: "+ server + ":"+srv.getPort());
			        
		        	return server+":"+srv.getPort();
		        	
		        }
		        
		        
		        
			} catch (TextParseException e) {
				// TODO Auto-generated catch block
				
				Log.e("EBUPLAYER", "error:"+l1.getErrorString()+l2.getErrorString());
				e.printStackTrace();
			}
			catch (Exception e){
				
				Log.e("EBUPLAYER", "error"+l1.getErrorString()+l2.getErrorString());
							
			}	
		return null;
	}
	
	
}
